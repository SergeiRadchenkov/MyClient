<!-- MyClient/templates/MyClient/profile.html -->

{% extends 'base.html' %}

{% block title %}Профиль{% endblock %}

{% block content %}

<!-- Модальное окно -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content custom-modal-content"> <!-- Добавлен класс для стилизации -->
            <div class="modal-header custom-modal-header"> <!-- Добавлен класс для стилизации -->
                <h5 class="modal-title" id="confirmDeleteModalLabel">Подтверждение удаления</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Вы уверены, что хотите удалить свой профиль?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Нет</button>
                <!-- Форма для отправки запроса на удаление профиля -->
                <form method="post" action="{% url 'delete_profile' %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">Да</button> <!-- Кнопка "Да" стилизована как btn-primary -->
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Контент страницы -->
<div class="profile-info">
    <p><strong>Имя и Фамилия:</strong> {{ first_name }} {{ last_name }}</p>
    <p><strong>Специальность:</strong> {{ specialization }}</p>
    <p><strong>Логин (эл. почта):</strong> {{ user }}</p>
    <!-- Шестерёнка видна только если show_settings_btn -->
    {% if show_settings_btn %}
        <a href="{% url 'settings' %}" class="settings-btn">
            <i class="fa fa-cogs"></i> <!-- Иконка шестерёнки -->
        </a>
</div>
    {% endif %}
{% block extra_content %}

<!-- Блоки аналитики -->
<div class="analytics-container">
    <!-- Незавершенные встречи -->
    <div class="analytics-block">
        <p><strong>Незавершенные встречи</strong></p>
        {% if unfinished_meetings %}
            <div class="meetings-list">
                {% for meeting in unfinished_meetings %}
                <div class="meeting-item">
                    <div>{{ meeting.date }} {{ meeting.time }} - {{ meeting.client }}</div>
                    <div class="status-badges">
                        {% if not meeting.is_paid %}<span class="badge bg-warning">Не оплачено</span>{% endif %}
                        {% if not meeting.is_canceled %}<span class="badge bg-danger">Активно</span>{% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <p>Нет незавершенных встреч</p>
        {% endif %}
    </div>

    <!-- Статистические блоки -->
    {% for period in periods %}
    <div class="analytics-block">
        <p><strong>{{ period.title }}</strong></p>
        <div class="stats-grid">
            <div class="stat-item">
                <span class="stat-label">Завершено встреч:</span>
                <span class="stat-value">{{ period.completed }}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Сумма оплат:</span>
                <span class="stat-value">{{ period.total_paid|default:0  }}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Оплачено блоков:</span>
                <span class="stat-value">{{ period.blocks_paid|default:0  }}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Отмены:</span>
                <span class="stat-value">{{ period.cancelled }}</span>
            </div>
        </div>

        <div class="clients-stats">
            {% for client in period.clients_stats %}
            <div class="client-stat">
                <div class="client-name">{{ client.name }}</div>
                <div class="client-numbers">
                    <span>Встреч: {{ client.completed }}</span>
                    <span>Отмен: {{ client.cancelled }}</span>
                </div>
            </div>
            {% empty %}
            <p>Нет данных о клиентах</p>
            {% endfor %}
        </div>
    </div>
    {% endfor %}

    <!-- Общая статистика -->
    <div class="analytics-block">
        <p><strong>Вся статистика</strong></p>
        <div class="stats-grid">
            <div class="stat-item">
                <span class="stat-label">Всего завершено:</span>
                <span class="stat-value">{{ lifetime_stats.completed }}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Общая сумма оплат:</span>
                <span class="stat-value">{{ lifetime_stats.total_paid|default:0 }}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Всего блоков:</span>
                <span class="stat-value">{{ lifetime_stats.blocks_paid|default:0 }}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Всего отмен:</span>
                <span class="stat-value">{{ lifetime_stats.cancelled }}</span>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% endblock %}


